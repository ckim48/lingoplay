{% extends "base.html" %}
{% block title %}Finish the Story · LingoPlay{% endblock %}
{% block content %}

<!-- HEADER -->

<div class="row g-4 mt-4 mb-4">
  <!-- LEFT: Unfinished drafts -->
  <div class="col-lg-6 col-xl-5">
    <div class="card border-0 lp-card-modern h-100">
      <div class="card-body p-4 p-lg-5">
        <div class="d-flex align-items-center gap-2 mb-3">
          <span class="badge lp-badge-step">1</span>
          <h6 class="mb-0 text-muted text-uppercase small fw-bold">Your Unfinished Drafts</h6>
        </div>

        <ul class="list-group list-group-flush">
          {% for d in drafts %}
            <li class="list-group-item d-flex justify-content-between align-items-center lp-list-item">
              <div class="me-3">
                <a class="text-decoration-none fw-semibold lp-link-lime" href="{{ url_for('finish_view', draft_id=d.id) }}">
                  {{ d.story_title or "(Untitled Story)" }}
                </a>
                <div class="small text-secondary mt-1">
                  <span class="text-muted">Key phonics:</span>
                  {{ d.seed_prompt }}
                  <span class="mx-2">·</span>
                  <span class="badge lp-badge-lang align-text-bottom">{{ d.language|upper }}</span>
                </div>
              </div>
              <span class="small text-secondary text-nowrap">
                <i class="bi bi-clock me-1"></i>{{ d.created_at|dt("%Y-%m-%d %H:%M") }}
              </span>
            </li>
          {% else %}
            <li class="list-group-item text-secondary">No unfinished drafts yet.</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>

  <!-- RIGHT: Tips / CTA -->
  <div class="col-lg-6 col-xl-7">
    <div class="card border-0 lp-card-modern h-100">
      <div class="card-body p-4 p-lg-5 d-flex align-items-center justify-content-center text-center">
        <div>
          <div class="mb-3 display-6"><i class="bi bi-pencil-square"></i></div>
          <p class="text-secondary mb-3">
            Create a phonics or vocabulary seed to get a partial story. Then add your ending!
          </p>
          <button
            type="button"
            class="btn btn-lime-light"
            data-bs-toggle="modal"
            data-bs-target="#newDraftModal"
          >
            <i class="bi bi-magic me-1"></i> Start a New Draft
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Floating Action Button (mobile friendly) -->
<button
  type="button"
  class="btn btn-lime shadow-lg rounded-circle p-0 d-flex align-items-center justify-content-center d-lg-none"
  style="position: fixed; right: 24px; bottom: 24px; width: 56px; height: 56px; font-size: 24px; line-height: 1;"
  data-bs-toggle="modal"
  data-bs-target="#newDraftModal"
  aria-label="Start a new draft"
  title="Start a new draft"
>
  <i class="bi bi-plus-lg"></i>
</button>

<!-- New Draft Modal -->
<div class="modal fade" id="newDraftModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <form method="post" class="modal-content border-0 rounded-4">
      <div class="modal-header border-0">
        <h5 class="modal-title">Start a New Draft</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body pt-0">
        <div class="mb-3">
          <label class="form-label small text-uppercase fw-bold text-muted">Seed (phonics / vocabulary)</label>
          <input name="seed_prompt" class="form-control lp-input-el" placeholder="r, rocket, rain" required>
        </div>

        <div class="row g-3">
          <div class="col-7">
            <label class="form-label small text-uppercase fw-bold text-muted">Learner Name</label>
            <input
              name="learner_name"
              class="form-control lp-input-el"
              placeholder="Student name"
              value="{{ (current_user.username if current_user else '') }}"
            >
            <div class="form-text">Defaults to your username if signed in.</div>
          </div>
          <div class="col-5">
            <label class="form-label small text-uppercase fw-bold text-muted">Language</label>
            <select name="language" class="form-select lp-input-el">
              <option value="en">English</option>
              <option value="ko">Korean</option>
              <option value="en-ko">English + Korean</option>
            </select>
          </div>
        </div>
      </div>

      <div class="modal-footer border-0">
        <button class="btn btn-lime">
          <i class="bi bi-arrow-return-right me-1"></i> Create Draft
        </button>
      </div>
    </form>
  </div>
</div>

<style>
  /* Lime palette (shared) */
  :root{
    --lp-lime-50:#f7fee7; --lp-lime-100:#ecfccb; --lp-lime-200:#d9f99d;
    --lp-lime-300:#bef264; --lp-lime-400:#a3e635; --lp-lime-500:#84cc16;
    --lp-lime-600:#65a30d; --lp-lime-700:#4d7c0f; --lp-border:#e5e7eb;
  }

  .lp-card-modern{
    border-radius:18px;
    box-shadow:0 10px 30px rgba(2,6,23,.06), 0 2px 6px rgba(2,6,23,.04);
  }

  .lp-title-lime{
    color:var(--lp-lime-700);
    letter-spacing:.2px;
  }

  /* Buttons */
  .btn-lime{
    --bs-btn-color:#fff;
    --bs-btn-bg:var(--lp-lime-600);
    --bs-btn-border-color:var(--lp-lime-600);
    --bs-btn-hover-bg:var(--lp-lime-700);
    --bs-btn-hover-border-color:var(--lp-lime-700);
    --bs-btn-focus-shadow-rgb:132,204,22;
    --bs-btn-active-bg:var(--lp-lime-700);
    --bs-btn-active-border-color:var(--lp-lime-700);
  }
  .btn-lime-light{
    --bs-btn-color:var(--lp-lime-700);
    --bs-btn-bg:var(--lp-lime-100);
    --bs-btn-border-color:var(--lp-lime-200);
    --bs-btn-hover-color:var(--lp-lime-700);
    --bs-btn-hover-bg:var(--lp-lime-200);
    --bs-btn-hover-border-color:var(--lp-lime-300);
    --bs-btn-focus-shadow-rgb:132,204,22;
    --bs-btn-active-bg:var(--lp-lime-300);
    --bs-btn-active-border-color:var(--lp-lime-300);
  }
  .btn-outline-lime{
    --bs-btn-color:var(--lp-lime-700);
    --bs-btn-border-color:var(--lp-lime-300);
    --bs-btn-hover-bg:var(--lp-lime-100);
    --bs-btn-hover-color:var(--lp-lime-700);
    --bs-btn-hover-border-color:var(--lp-lime-400);
    --bs-btn-focus-shadow-rgb:132,204,22;
    --bs-btn-active-bg:var(--lp-lime-200);
    --bs-btn-active-border-color:var(--lp-lime-400);
  }

  /* Inputs */
  .lp-input-el:focus, .form-select.lp-input-el:focus{
    border-color:var(--lp-lime-400)!important;
    box-shadow:0 0 0 .25rem rgba(132,204,22,.15)!important;
  }

  /* Badges */
  .lp-badge-step{
    background:var(--lp-lime-100);
    color:var(--lp-lime-700);
    border:1px solid var(--lp-lime-200);
    font-weight:600;
  }
  .lp-badge-lang{
    background:var(--lp-lime-50);
    color:var(--lp-lime-700);
    border:1px solid var(--lp-lime-200);
    font-weight:600;
  }

  /* List polish */
  .lp-list-item{
    border-color:var(--lp-border);
    transition:background .15s ease, transform .06s ease, border-color .2s ease;
  }
  .lp-list-item:hover{
    background:var(--lp-lime-50);
    border-color:var(--lp-lime-200);
  }
  .lp-link-lime{
    color:#111827;
  }
  .lp-link-lime:hover{
    color:var(--lp-lime-700);
  }
</style>

{% endblock %}
