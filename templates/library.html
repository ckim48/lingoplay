{% extends "base2.html" %}
{% block title %}Library Â· EduWeaverPlay{% endblock %}

{% block content %}
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&display=swap" rel="stylesheet">

<div class="container mt-4">
  {# Modernized Header Layout #}
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-5 pb-3 border-bottom border-v6-soft">
    <div class="d-flex align-items-center gap-4">
      <i class="bi bi-book-half display-5" style="color:#F87171 !important;"></i>
      <div>
        <h3 class="fw-bolder mb-1 v6-section-title">The Magic Bookshelf</h3>
        <p class="text-muted v6-section-p mb-0">
          Explore stories shared by your teacher. Tap any cover to begin reading!
        </p>
      </div>
    </div>
    {# Add a playful graphic/placeholder here for a modern touch #}
  </div>

  {% if stories %}
  <div class="row g-4 g-lg-5">
    {% for s in stories %}
    <div class="col-sm-6 col-lg-4 col-xl-3">
      <div class="book-wrap-v6">
        <div class="card border-0 library-card-v6 h-100 p-0 position-relative">

          {# Admin Remove Button #}
          {% if is_admin %}
          <form method="post" action="{{ url_for('admin_unshare_story', slug=s.slug) }}"
                onsubmit="return confirm('Are you sure you want to remove \'{{ s.title }}\' from the Library?');"
                class="admin-remove-form">
            <button type="submit" class="btn btn-sm library-remove-btn-v6">
              <i class="bi bi-x-lg"></i>
            </button>
          </form>
          {% endif %}

          <a href="{{ url_for('book_view', draft_id=s.draft_id) }}"
             class="text-decoration-none text-reset d-flex flex-column h-100">

            <div class="library-card-img-wrap-v6"
                 style="background-image: url('{{ s.visuals or url_for('static', filename='img/fallback_cover.png') }}');">
              </div>

            <div class="card-body p-3 p-md-4 d-flex flex-column flex-grow-1 bg-v6-paper">

              {# Tags Refined and Grouped #}
              <div class="d-flex align-items-center mb-2 gap-2">
                <span class="v6-tag-level">{{ s.language|upper }}</span>
                <span class="v6-tag-level v6-tag-level-accent">{{ s.level|title }}</span>
              </div>

              <h5 class="fw-bold mb-2 text-v6-title truncate-2-lines">
                {{ s.title }}
              </h5>

              <p class="small text-v6-muted mb-3 flex-grow-1">
                By <span class="fw-semibold">{{ s.author_name or "EduWeaver AI" }}</span>
              </p>

              <div class="mt-auto pt-3 d-flex justify-content-between align-items-center border-top border-v6-soft">
                <span class="badge tag-shared-v6">
                  Shared
                </span>
                <span class="small text-v6-link fw-bold">
                  Read Now <i class="bi bi-arrow-right-circle-fill ms-1"></i>
                </span>
              </div>
            </div>
          </a>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="py-5 text-center text-v6-muted">
    <p class="mb-1 fw-semibold">No stories in the Library yet.</p>
    <p class="small mb-0">
      Your teacher can share stories from the <span class="fw-bold">Story Review</span> page.
    </p>
    <i class="bi bi-box-seam display-4 mt-4 d-block" style="color: var(--color-v6-soft-border);"></i>
  </div>
  {% endif %}
</div>

<style>
/* --- V6 Modern & Attractive Styles --- */
/* Integrated modern font: Outfit */
body {
    font-family: 'Outfit', sans-serif;
    background-color: #fffaf3 !important;
}

/* V6 Color Palette (Clean & Playful) */
:root {
    --color-v6-primary: #3772FF; /* Royal Blue */
    --color-v6-primary-dark: #2B5AD9; /* Darker Royal Blue */
    --color-v6-accent: #3ECF8E;  /* Emerald Green for Links/Action */
    --color-v6-background: #F4F7FB; /* Soft Light Gray Background */
    --color-v6-paper: #FFFFFF;
    --color-v6-paper-bg: #FFFFFF; /* Pure white for card body */
    --color-v6-soft-border: #E5E9F2; /* Light Border/Divider */
    --color-v6-heading: #1A1D2B; /* Near Black */
    --color-v6-muted: #6C7383; /* Soft Gray Text */
    --color-v6-level-tag-bg: #E0EFFF; /* Very Light Blue Tag BG */
    --color-v6-level-tag-text: #1E40AF; /* Dark Blue Tag Text */
    --color-v6-shadow-light: rgba(60, 66, 87, 0.1);
    --color-v6-shadow-deep: rgba(26, 29, 43, 0.1);
}

/* Utility Classes */
.text-v6-primary { color: var(--color-v6-primary) !important; }
.text-v6-primary-dark { color: var(--color-v6-primary-dark) !important; }
.text-v6-heading { color: var(--color-v6-heading) !important; }
.text-v6-muted { color: var(--color-v6-muted) !important; }
.bg-v6-paper { background-color: var(--color-v6-paper-bg) !important; }
.border-v6-soft { border-color: var(--color-v6-soft-border) !important; }
.text-v6-link { color: var(--color-v6-accent) !important; }
.truncate-2-lines {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    min-height: 2.8em; /* Ensure consistent height for two lines */
}

/* --- HEADER STYLES V6 --- */
.v6-section-title {
    font-size: 2rem;
    color: var(--color-v6-heading);
    line-height: 1.1;
    font-weight: 800; /* Extra bold */
}
.v6-section-p {
    font-size: 1rem;
    color: var(--color-v6-muted) !important;
}

/* --- BOOK CARD STYLES V6 --- */

/* Card Wrapper (3D effect refinement) */
.book-wrap-v6 {
    perspective: 1200px;
    transform-style: preserve-3d;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.book-wrap-v6:hover {
    transform: translateY(-8px) rotateX(1deg) rotateY(-1deg);
    /* Subtle glow on hover */
    box-shadow: 0 15px 30px -10px rgba(55, 114, 255, 0.2);
}

/* Library Card Styles V6 (The Book Cover) */
.library-card-v6 {
    background: var(--color-v6-paper);
    border-radius: 18px !important;
    /* Refined modern shadow (Soft, elevated look) */
    box-shadow:
        0 8px 16px var(--color-v6-shadow-light),
        0 1px 2px var(--color-v6-shadow-deep);
    transition: all 0.3s ease;
    transform: translateZ(10px);
}
/* No 'Spine' effect for a flatter, more modern card look */
/* Removed ::before pseudo-element */


/* Cover Image Wrapper V6 (Aspect Ratio change for a sleeker look) */
.library-card-img-wrap-v6 {
    width: 100%;
    padding-top: 100%; /* Square aspect ratio (1:1) is very modern */
    background-size: cover;
    background-position: center;
    background-color: var(--color-v6-soft-border);
    border-radius: 18px 18px 0 0 !important;
    border-bottom: 3px solid var(--color-v6-soft-border);
    position: relative;
}
/* Subtle overlay on image to make it pop */
.library-card-img-wrap-v6::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.05); /* Very light dark overlay */
    transition: background 0.3s;
    border-radius: 18px 18px 0 0 !important;
}
.book-wrap-v6:hover .library-card-img-wrap-v6::after {
    background: rgba(0, 0, 0, 0.02);
}


/* Card Body Title */
.text-v6-title {
    font-size: 1.35rem; /* Slightly larger, bold title */
    line-height: 1.3;
    color: var(--color-v6-heading);
}

/* Level/Language Tags V6 (Pill Shape, Clean Colors) */
.v6-tag-level {
    display: inline-block;
    padding: 0.3rem 0.8rem;
    border-radius: 50px; /* Full pill shape */
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    background-color: var(--color-v6-level-tag-bg);
    color: var(--color-v6-level-tag-text);
    transition: background-color 0.2s;
}
.v6-tag-level-accent {
    background-color: #FCE7F6; /* Soft Pink */
    color: #9D174D; /* Dark Pink */
}

/* Shared Status Badge V6 (More integrated look) */
.tag-shared-v6 {
    background-color: var(--color-v6-primary);
    color: var(--color-v6-paper);
    font-weight: 600;
    padding: 0.3rem 0.75rem;
    border-radius: 6px; /* Squarer, modern pill */
    font-size: 0.75rem;
    box-shadow: 0 4px 8px rgba(55, 114, 255, 0.2);
}

/* Admin Remove Button V6 (Subtle, professional) */
.library-remove-btn-v6 {
    position: absolute;
    top: 15px;
    right: 15px;
    z-index: 20;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    font-size: 0.9rem;
    background-color: #F87171 !important; /* Soft Red */
    color: white;
    border: none;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    border-radius: 50% !important;
    opacity: 0.95;
    transition: opacity 0.2s, transform 0.2s, background-color 0.2s;
}
.library-remove-btn-v6:hover {
    opacity: 1;
    transform: scale(1.08);
    background-color: #DC2626 !important; /* Darker Red */
}
</style>

{% endblock %}